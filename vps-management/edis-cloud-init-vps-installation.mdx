---
title: "Provision EDBB VPS with Cloud-Init"
sidebarTitle: "* Cloud-Init"
description: "Learn how EDBB deploys cloud-init enabled images, where to provide user-data, and how to customize first-boot automation."
---

import { CtaButton } from "/snippets/cta-button.mdx";

## Why EDBB Uses Cloud-Init

- **Automation** – configure hostnames, users, SSH keys, and services without touching the console.  
- **Speed** – qcow2 templates boot quickly; first-boot scripts complete in minutes.  
- **Consistency** – the same user-data file produces identical builds across regions.  
- **Scalability** – perfect for provisioning fleets via the EDBB API or portal.

---

## Provide User-Data During Deploy or Reinstall

### New Orders

1. In the order form, select a Cloud-Init ready Linux image.  
2. Paste your `#cloud-config` content into the **Cloud-Init user-data** box.  
3. Complete checkout—once payment clears, the VPS boots and applies the configuration.

### Existing VPS (Reinstall Workflow)

1. In the EDBB portal, open **Services → your VPS → Reinstall**.  
2. Choose the target image and paste/replace the user-data.  
3. Confirm the reinstall. The VPS wipes the disk, boots the new image, and runs your script.

Need to adjust user-data later? Repeat the reinstall with updated YAML or switch to manual post-boot configuration.

---

## Understanding `cloudinit_user_data`

Cloud-Init consumes YAML documents that begin with `#cloud-config`.  
During the first boot, the directives in that document are executed in order—covering everything from package installs to systemd service tweaks.

### Sample Scenario: Deploy a Python App Host

```yaml
#cloud-config
hostname: app-node-01
users:
  - default
  - name: deploy
    groups: sudo
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIExampleKeyHere
package_update: true
package_upgrade: true
packages:
  - python3-venv
  - nginx
write_files:
  - path: /etc/systemd/system/app.service
    owner: root:root
    permissions: "0644"
    content: |
      [Unit]
      Description=Gunicorn Application
      After=network.target

      [Service]
      User=deploy
      WorkingDirectory=/opt/app
      ExecStart=/opt/app/.venv/bin/gunicorn wsgi:app --bind 0.0.0.0:8000
      Restart=always

      [Install]
      WantedBy=multi-user.target
runcmd:
  - [mkdir, -p, /opt/app]
  - [chown, -R, deploy:deploy, /opt/app]
  - [runuser, -l, deploy, -c, "python3 -m venv /opt/app/.venv"]
  - [systemctl, daemon-reload]
  - [systemctl, enable, --now, app.service]
power_state:
  mode: reboot
```

#### Highlights

- `hostname` – sets the server name for logs and prompts.  
- `users` – provisions a `deploy` account with sudo access and SSH key authentication.  
- `package_update` / `package_upgrade` – ensure the instance begins with current patches.  
- `packages` – installs Python and NGINX immediately after first boot.  
- `write_files` – drops a systemd unit that manages your Gunicorn app.  
- `runcmd` – prepares the app directory, ownership, virtual environment, and starts the service.  
- `power_state` – triggers a reboot once provisioning finishes so services start clean on subsequent boots.

---

## Validate and Troubleshoot

- **Log review** – after boot, run `sudo cloud-init status` or check `/var/log/cloud-init.log` for detailed output.  
- **Redeploy** – if something misfires, edit the YAML, reinstall, and Cloud-Init replays from scratch.  
- **Version control** – store your user-data files in Git to track changes across environments.

---

## Additional Tips

- Combine Cloud-Init with EDBB’s API to generate instances programmatically.  
- Use multipart MIME format if you need to supply scripts alongside `#cloud-config`.  
- For images that do not include Cloud-Init, reinstall with a supported template before providing user-data.

---

<CtaButton label="Official Cloud-Init Documentation" link="https://cloudinit.readthedocs.io/en/latest/" openInNewTab={true} />
